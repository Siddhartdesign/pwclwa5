<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Neumorphic Clock</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#ecf0f3">
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="NeuClock">

<style>
/* =========================
   THEME DEFINITIONS
   ========================= */

/* 0 ‚Äî WHITE (LOCKED) */
body.theme-white {
  --bg: #ecf0f3;
  --light: #ffffff;
  --shadow: rgba(0,0,0,.16);
  --text: #444;
  --display-text: #444;
}

/* 1 ‚Äî BEIGE (BOUTIQUE) */
body.theme-beige {
  --bg: #dbd1c7;
  --light: #f3ece4;
  --shadow: rgba(88, 68, 48, 0.26);
  --text: #4b4036;
  --display-text: #3b2f24;
}

/* 2 ‚Äî GREY (CALM, DARKER) */
body.theme-grey {
  --bg: #c3c8cf;
  --light: #e6e9ed;
  --shadow: rgba(55, 60, 66, 0.32);
  --text: #35393d;
  --display-text: #2e3236;
}

/* 3 ‚Äî INDIGO / VIOLET */
body.theme-indigo {
  --bg: #3b2bb3;
  --light: #4a39d6;
  --shadow: rgba(20, 15, 60, 0.65);
  --text: #e9e6ff;
  --display-text: #ffffff;
}

/* 4 ‚Äî CRIMSON / WINE */
body.theme-crimson {
  --bg: #7a1f22;
  --light: #8e2a2d;
  --shadow: rgba(45, 10, 10, 0.65);
  --text: #f3eaea;
  --display-text: #ffffff;
}

/* 5 ‚Äî DARK (LOCKED) */
body.theme-dark {
  --bg: #1e1e1e;
  --light: #2a2a2a;
  --shadow: rgba(0,0,0,.85);
  --text: #f0f0f0;
  --display-text: #f0f0f0;
}

/* 6 ‚Äî OCEAN BLUE */
body.theme-ocean {
  --bg: #2c5f8d;
  --light: #3a7ab5;
  --shadow: rgba(15, 30, 45, 0.6);
  --text: #e3f2fd;
  --display-text: #ffffff;
}

/* 7 ‚Äî EMERALD GREEN */
body.theme-emerald {
  --bg: #1e7a5f;
  --light: #26a577;
  --shadow: rgba(10, 40, 30, 0.6);
  --text: #e0f5f0;
  --display-text: #ffffff;
}

/* 8 ‚Äî SUNSET ORANGE */
body.theme-sunset {
  --bg: #d97638;
  --light: #f58d4a;
  --shadow: rgba(80, 35, 15, 0.5);
  --text: #2a1f1a;
  --display-text: #1a0f0a;
}

/* 9 ‚Äî LAVENDER */
body.theme-lavender {
  --bg: #9b8fc9;
  --light: #bfb3e0;
  --shadow: rgba(45, 35, 65, 0.4);
  --text: #2e2640;
  --display-text: #1f1830;
}

/* 10 ‚Äî ROSE PINK */
body.theme-rose {
  --bg: #d97598;
  --light: #f293b5;
  --shadow: rgba(75, 25, 40, 0.45);
  --text: #4a1f30;
  --display-text: #2d1820;
}

/* 11 ‚Äî TEAL */
body.theme-teal {
  --bg: #2d8b8b;
  --light: #3ab0b0;
  --shadow: rgba(15, 45, 45, 0.55);
  --text: #e0f5f5;
  --display-text: #ffffff;
}

/* 12 ‚Äî AMBER GOLD */
body.theme-amber {
  --bg: #c9a858;
  --light: #e6c56f;
  --shadow: rgba(70, 50, 20, 0.45);
  --text: #3d2f1a;
  --display-text: #2d1f0a;
}

/* 13 ‚Äî MINT GREEN */
body.theme-mint {
  --bg: #a8d5ba;
  --light: #c5edd7;
  --shadow: rgba(40, 60, 45, 0.35);
  --text: #2d4535;
  --display-text: #1f3025;
}

/* 14 ‚Äî CORAL */
body.theme-coral {
  --bg: #e88a7a;
  --light: #ffab9d;
  --shadow: rgba(80, 35, 30, 0.4);
  --text: #4a2520;
  --display-text: #2d1510;
}

/* 15 ‚Äî MIDNIGHT BLUE */
body.theme-midnight {
  --bg: #1a2740;
  --light: #253654;
  --shadow: rgba(5, 10, 20, 0.75);
  --text: #d5e5f5;
  --display-text: #ffffff;
}

/* =========================
   BASE
   ========================= */

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  background-color: var(--bg);
  font-family: system-ui, sans-serif;
}

body {
  transition: background-color .35s ease;
}

.container {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px 0;
}

.panel {
  width: min(92vw, 380px);
  padding: 18px;
  border-radius: 32px;
  box-shadow:
    inset 6px 6px 14px var(--light),
    6px 6px 14px var(--shadow);
}

.grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 14px;
}

/* =========================
   DISPLAY
   ========================= */

.display {
  grid-column: span 4;
  height: calc(3 * 64px);
  border-radius: 28px;
  border: none;
  text-align: center;
  font-size: 38px;
  color: var(--display-text);
  box-shadow:
    inset -6px -6px 14px var(--light),
    inset 6px 6px 14px var(--shadow);
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0% {
    box-shadow: inset -6px -6px 14px var(--light),
                inset 6px 6px 14px var(--shadow);
  }
  50% {
    box-shadow: inset -3px -3px 7px var(--light),
                inset 3px 3px 7px var(--shadow);
  }
  100% {
    box-shadow: inset -6px -6px 14px var(--light),
                inset 6px 6px 14px var(--shadow);
  }
}

/* =========================
   BUTTONS
   ========================= */

button {
  aspect-ratio: 1 / 1;
  width: 100%;
  border-radius: 50%;
  border: none;
  font-weight: 600;
  font-size: 14px;
  color: var(--text);
  box-shadow:
    -6px -6px 14px var(--light),
    6px 6px 14px var(--shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.1s ease;
}

button:active {
  transform: scale(0.94);
  box-shadow:
    inset -4px -4px 10px var(--light),
    inset 4px 4px 10px var(--shadow);
}

button.active {
  box-shadow:
    inset -4px -4px 10px var(--light),
    inset 4px 4px 10px var(--shadow);
}

button svg {
  width: 22px;
  height: 22px;
  stroke: currentColor;
  fill: none;
}

/* =========================
   SPANS
   ========================= */

.span-2 {
  grid-column: span 2;
  aspect-ratio: auto;
  border-radius: 40px;
}

.span-3 {
  grid-column: span 3;
  aspect-ratio: auto;
  border-radius: 44px;
}

.label {
  font-size: 13px;
  letter-spacing: .5px;
}

/* Notification */
.notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--bg);
  color: var(--text);
  padding: 12px 24px;
  border-radius: 20px;
  box-shadow: 0 4px 12px var(--shadow);
  opacity: 0;
  transition: opacity 0.3s;
  z-index: 1000;
  font-size: 14px;
  font-weight: 600;
}

.notification.show {
  opacity: 1;
}
</style>
</head>

<body class="theme-white">
<div class="notification" id="notification"></div>
<div class="container">
  <div class="panel">
    <div class="grid">

      <input class="display" id="display" readonly>

      <button id="clockBtn">CLOCK</button>

      <!-- STOPWATCH BUTTON -->
      <button id="stopwatchBtn" aria-label="Stopwatch">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="13" r="8"/>
          <path d="M12 9v4l2 2"/>
          <path d="M5 3L19 3"/>
        </svg>
      </button>

      <!-- TIMER BUTTON -->
      <button id="timerBtn" aria-label="Timer">
        <svg viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="13" r="8"/>
          <path d="M12 7v6"/>
          <path d="M16 13h-4"/>
        </svg>
      </button>
      
      <button id="themeBtn">THEME</button>

      <button id="alarmBtn">ALARM</button>
      <button id="worldBtn">WORLD</button>
      <button class="span-2 label" id="status">LIVE</button>

      <button id="toggle24">24H</button>
      <button class="span-3 label" id="dateDisplay">Loading...</button>

      <!-- FUNCTIONAL ROW -->
      <button id="pomodoroBtn" title="Pomodoro Timer">üçÖ</button>
      <button id="favoriteBtn" title="Favorite Theme">‚òÜ</button>
      <button id="brightnessBtn" title="Brightness">‚óê</button>
      <button id="soundBtn" title="Sound On/Off">‚ô™</button>

    </div>
  </div>
</div>

<script>
// Register Service Worker for PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js')
    .catch(err => console.log('SW registration failed'));
}

const display = document.getElementById("display");
const status = document.getElementById("status");
const dateDisplay = document.getElementById("dateDisplay");
const notification = document.getElementById("notification");

// Button references
const toggle24 = document.getElementById("toggle24");
const clockBtn = document.getElementById("clockBtn");
const stopwatchBtn = document.getElementById("stopwatchBtn");
const timerBtn = document.getElementById("timerBtn");
const themeBtn = document.getElementById("themeBtn");
const alarmBtn = document.getElementById("alarmBtn");
const worldBtn = document.getElementById("worldBtn");
const pomodoroBtn = document.getElementById("pomodoroBtn");
const favoriteBtn = document.getElementById("favoriteBtn");
const brightnessBtn = document.getElementById("brightnessBtn");
const soundBtn = document.getElementById("soundBtn");

// State
let mode = "clock";
let is24h = false;
let soundEnabled = true;

// Stopwatch state
let stopwatchStart = null;
let stopwatchRunning = false;
let stopwatchElapsed = 0;

// Timer state
let timerSeconds = 300; // 5 minutes default
let timerRunning = false;
let timerStart = null;
let timerRemaining = timerSeconds;

// Alarm state
let alarmHour = 8;
let alarmMinute = 0;
let alarmEnabled = false;

// Pomodoro state
let pomodoroMode = "work"; // work, break
let pomodoroRunning = false;
let pomodoroStart = null;
let pomodoroWorkTime = 25 * 60; // 25 minutes
let pomodoroBreakTime = 5 * 60; // 5 minutes
let pomodoroRemaining = pomodoroWorkTime;

// World clock
let worldTimezone = "UTC";

// Brightness
let brightnessLevel = 2; // 0=dim, 1=normal, 2=bright

const themes = [
  "theme-white", "theme-beige", "theme-grey", "theme-indigo",
  "theme-crimson", "theme-dark", "theme-ocean", "theme-emerald",
  "theme-sunset", "theme-lavender", "theme-rose", "theme-teal",
  "theme-amber", "theme-mint", "theme-coral", "theme-midnight"
];

let themeIndex = 0;
let favoriteTheme = null;

// Load saved preferences
function loadPreferences() {
  const saved = localStorage.getItem('clockPrefs');
  if (saved) {
    const prefs = JSON.parse(saved);
    themeIndex = prefs.themeIndex || 0;
    is24h = prefs.is24h || false;
    soundEnabled = prefs.soundEnabled !== false;
    favoriteTheme = prefs.favoriteTheme || null;
    brightnessLevel = prefs.brightnessLevel || 2;
    
    document.body.classList.remove(...themes);
    document.body.classList.add(themes[themeIndex]);
    toggle24.textContent = is24h ? "12H" : "24H";
    updateBrightness();
    updateSoundButton();
    updateFavoriteButton();
  }
}

function savePreferences() {
  localStorage.setItem('clockPrefs', JSON.stringify({
    themeIndex, is24h, soundEnabled, favoriteTheme, brightnessLevel
  }));
}

function haptic(ms = 10) {
  if (navigator.vibrate) navigator.vibrate(ms);
}

function playSound(type = 'click') {
  if (!soundEnabled) return;
  
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  if (type === 'alarm') {
    oscillator.frequency.value = 800;
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
  } else {
    oscillator.frequency.value = 600;
    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.1);
  }
}

function showNotification(message) {
  notification.textContent = message;
  notification.classList.add('show');
  setTimeout(() => {
    notification.classList.remove('show');
  }, 2000);
}

function updateBrightness() {
  const levels = ['0.6', '0.8', '1'];
  document.body.style.opacity = levels[brightnessLevel];
  brightnessBtn.textContent = ['‚óî', '‚óë', '‚óï'][brightnessLevel];
}

function updateSoundButton() {
  soundBtn.textContent = soundEnabled ? '‚ô™' : '‚ô´';
  soundBtn.classList.toggle('active', !soundEnabled);
}

function updateFavoriteButton() {
  favoriteBtn.textContent = favoriteTheme === themeIndex ? '‚òÖ' : '‚òÜ';
}

function updateDate() {
  const now = new Date();
  const options = { weekday: 'short', month: 'short', day: 'numeric' };
  dateDisplay.textContent = now.toLocaleDateString('en-US', options).toUpperCase();
}

function formatTime(hours, minutes, seconds) {
  let h = hours;
  let am = "";
  
  if (!is24h) {
    am = h >= 12 ? " PM" : " AM";
    h = h % 12 || 12;
  }
  
  return `${String(h).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}${am}`;
}

function update() {
  const now = new Date();
  
  if (mode === "clock") {
    display.value = formatTime(now.getHours(), now.getMinutes(), now.getSeconds());
    status.textContent = "LIVE";
    
    // Check alarm
    if (alarmEnabled && now.getHours() === alarmHour && now.getMinutes() === alarmMinute && now.getSeconds() === 0) {
      playSound('alarm');
      showNotification('‚è∞ ALARM!');
      haptic(500);
    }
  }

  if (mode === "stopwatch") {
    if (stopwatchRunning) {
      const t = Math.floor((Date.now() - stopwatchStart + stopwatchElapsed) / 1000);
      const mins = Math.floor(t / 60);
      const secs = t % 60;
      display.value = `‚è± ${String(mins).padStart(2,"0")}:${String(secs).padStart(2,"0")}`;
    }
    status.textContent = stopwatchRunning ? "RUNNING" : "STOPPED";
  }

  if (mode === "timer") {
    if (timerRunning) {
      const elapsed = Math.floor((Date.now() - timerStart) / 1000);
      timerRemaining = Math.max(0, timerSeconds - elapsed);
      
      if (timerRemaining === 0) {
        timerRunning = false;
        playSound('alarm');
        showNotification('‚è≤ Timer Complete!');
        haptic(500);
      }
    }
    
    const mins = Math.floor(timerRemaining / 60);
    const secs = timerRemaining % 60;
    display.value = `‚è≤ ${String(mins).padStart(2,"0")}:${String(secs).padStart(2,"0")}`;
    status.textContent = timerRunning ? "RUNNING" : "TIMER";
  }

  if (mode === "alarm") {
    const ampm = !is24h && alarmHour >= 12 ? " PM" : (!is24h ? " AM" : "");
    const h = !is24h ? (alarmHour % 12 || 12) : alarmHour;
    display.value = `üîî ${String(h).padStart(2,"0")}:${String(alarmMinute).padStart(2,"0")}${ampm}`;
    status.textContent = alarmEnabled ? "ENABLED" : "DISABLED";
  }

  if (mode === "world") {
    const utc = new Date(now.toLocaleString('en-US', { timeZone: 'UTC' }));
    display.value = `üåç ${formatTime(utc.getHours(), utc.getMinutes(), utc.getSeconds())}`;
    status.textContent = "UTC";
  }

  if (mode === "pomodoro") {
    if (pomodoroRunning) {
      const elapsed = Math.floor((Date.now() - pomodoroStart) / 1000);
      const totalTime = pomodoroMode === "work" ? pomodoroWorkTime : pomodoroBreakTime;
      pomodoroRemaining = Math.max(0, totalTime - elapsed);
      
      if (pomodoroRemaining === 0) {
        pomodoroRunning = false;
        pomodoroMode = pomodoroMode === "work" ? "break" : "work";
        playSound('alarm');
        showNotification(pomodoroMode === "work" ? '‚òï Break Over!' : 'üçÖ Work Time!');
        haptic(500);
        pomodoroRemaining = pomodoroMode === "work" ? pomodoroWorkTime : pomodoroBreakTime;
      }
    }
    
    const mins = Math.floor(pomodoroRemaining / 60);
    const secs = pomodoroRemaining % 60;
    const icon = pomodoroMode === "work" ? "üçÖ" : "‚òï";
    display.value = `${icon} ${String(mins).padStart(2,"0")}:${String(secs).padStart(2,"0")}`;
    status.textContent = pomodoroRunning ? (pomodoroMode === "work" ? "FOCUS" : "BREAK") : "PAUSED";
  }
}

setInterval(() => {
  update();
  updateDate();
}, 100);

// Clock button
clockBtn.onclick = () => {
  mode = "clock";
  stopwatchRunning = false;
  timerRunning = false;
  pomodoroRunning = false;
  update();
  haptic(30);
  playSound();
};

// Stopwatch button
stopwatchBtn.onclick = () => {
  if (mode !== "stopwatch") {
    mode = "stopwatch";
    stopwatchStart = Date.now();
    stopwatchElapsed = 0;
    stopwatchRunning = true;
  } else {
    if (stopwatchRunning) {
      stopwatchElapsed += Date.now() - stopwatchStart;
      stopwatchRunning = false;
    } else {
      stopwatchStart = Date.now();
      stopwatchRunning = true;
    }
  }
  update();
  haptic(30);
  playSound();
};

// Long press to reset stopwatch
stopwatchBtn.oncontextmenu = (e) => {
  e.preventDefault();
  if (mode === "stopwatch") {
    stopwatchElapsed = 0;
    stopwatchRunning = false;
    update();
    showNotification('Stopwatch Reset');
    haptic(50);
  }
};

// Timer button
timerBtn.onclick = () => {
  if (mode !== "timer") {
    mode = "timer";
    timerRemaining = timerSeconds;
    timerRunning = false;
  } else {
    if (!timerRunning) {
      timerStart = Date.now();
      timerRunning = true;
    } else {
      timerRunning = false;
    }
  }
  update();
  haptic(30);
  playSound();
};

// Long press to adjust timer
timerBtn.oncontextmenu = (e) => {
  e.preventDefault();
  if (mode === "timer") {
    timerSeconds = (timerSeconds + 60) % 3600;
    if (timerSeconds === 0) timerSeconds = 60;
    timerRemaining = timerSeconds;
    timerRunning = false;
    update();
    showNotification(`Timer: ${Math.floor(timerSeconds/60)}min`);
    haptic(50);
  }
};

// Alarm button
alarmBtn.onclick = () => {
  if (mode !== "alarm") {
    mode = "alarm";
  } else {
    alarmEnabled = !alarmEnabled;
    showNotification(alarmEnabled ? 'Alarm Enabled' : 'Alarm Disabled');
  }
  update();
  haptic(30);
  playSound();
};

// Long press to adjust alarm
alarmBtn.oncontextmenu = (e) => {
  e.preventDefault();
  if (mode === "alarm") {
    alarmMinute = (alarmMinute + 15) % 60;
    if (alarmMinute === 0) alarmHour = (alarmHour + 1) % 24;
    update();
    showNotification('Alarm Time Adjusted');
    haptic(50);
  }
};

// World clock button
worldBtn.onclick = () => {
  mode = "world";
  update();
  haptic(30);
  playSound();
};

// Theme button
themeBtn.onclick = () => {
  document.body.classList.remove(themes[themeIndex]);
  themeIndex = (themeIndex + 1) % themes.length;
  document.body.classList.add(themes[themeIndex]);
  updateFavoriteButton();
  savePreferences();
  haptic(20);
  playSound();
};

// 24H toggle
toggle24.onclick = () => {
  is24h = !is24h;
  toggle24.textContent = is24h ? "12H" : "24H";
  savePreferences();
  update();
  haptic(15);
  playSound();
};

// Pomodoro button
pomodoroBtn.onclick = () => {
  if (mode !== "pomodoro") {
    mode = "pomodoro";
    pomodoroMode = "work";
    pomodoroRemaining = pomodoroWorkTime;
    pomodoroRunning = false;
  } else {
    if (!pomodoroRunning) {
      pomodoroStart = Date.now();
      pomodoroRunning = true;
    } else {
      pomodoroRunning = false;
    }
  }
  update();
  haptic(30);
  playSound();
};

// Long press to reset pomodoro
pomodoroBtn.oncontextmenu = (e) => {
  e.preventDefault();
  if (mode === "pomodoro") {
    pomodoroMode = "work";
    pomodoroRemaining = pomodoroWorkTime;
    pomodoroRunning = false;
    update();
    showNotification('Pomodoro Reset');
    haptic(50);
  }
};

// Favorite theme button
favoriteBtn.onclick = () => {
  if (favoriteTheme === themeIndex) {
    favoriteTheme = null;
    showNotification('Favorite Cleared');
  } else {
    favoriteTheme = themeIndex;
    showNotification('Theme Favorited');
  }
  updateFavoriteButton();
  savePreferences();
  haptic(25);
  playSound();
};

// Long press to jump to favorite
favoriteBtn.oncontextmenu = (e) => {
  e.preventDefault();
  if (favoriteTheme !== null) {
    document.body.classList.remove(themes[themeIndex]);
    themeIndex = favoriteTheme;
    document.body.classList.add(themes[themeIndex]);
    savePreferences();
    showNotification('Jumped to Favorite');
    haptic(50);
  }
};

// Brightness button
brightnessBtn.onclick = () => {
  brightnessLevel = (brightnessLevel + 1) % 3;
  updateBrightness();
  savePreferences();
  haptic(25);
  playSound();
};

// Sound button
soundBtn.onclick = () => {
  soundEnabled = !soundEnabled;
  updateSoundButton();
  savePreferences();
  showNotification(soundEnabled ? 'Sound On' : 'Sound Off');
  haptic(25);
  if (soundEnabled) playSound();
};

// Initialize
loadPreferences();
update();
updateDate();
</script>
</body>
</html>